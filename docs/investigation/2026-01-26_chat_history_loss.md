# チャット履歴消失問題に関する調査報告 (第5回)

**調査日時:** 2026-01-26T00:15+09:00
**調査担当:** Gemini (Session: `8f37d7f2`)

## 1. 調査結果サマリー
**結論: エージェントの内部記憶領域（Brain）において、物理的なデータ消失が再発しました。**

直前のセッション (`27c7f4b3...`) のデータディレクトリが**空（Empty Directory）**であることを確認しました。メタデータ（会話の要約）は残っていますが、実際の作業ログやタスクファイル (`task.md`) は物理的に消滅しています。これは過去4回の事例と完全に一致する挙動です。

## 2. 詳細確認事項

### システム状況
- **現在時刻**: 2026-01-26 00:15
- **対象ディレクトリ**: `~/.gemini/antigravity/brain/`

### セッションごとのデータ状態確認
以下の通り、ディレクトリの中身を直接確認しました。

1.  **直前のセッション (`27c7f4b3-2c70-43e9-8fbf-eec8fe91b2e6`)**
    - 作成日時: 2026-01-25 15:12
    - **状態**: **空 (データ損失)**
    - **判定**: このセッションで行われた「チャット中の作業」は、物理ファイルとしては全て失われました。ユーザーが体験した「履歴の消失」はこれに該当します。

2.  **前々回のセッション (`355943e1-5bea-487d-9a50-2be4b3265fc7`)**
    - 作成日時: 2026-01-25 15:09
    - **状態**: **空 (データ損失)**

3.  **現在のセッション (`8f37d7f2-6383-46bb-a4a2-6986dc97ef92`)**
    - **状態**: 正常 (書き込み可能)
    - `task.md` の作成と更新に成功しています。ただし、このセッションも終了後や特定のタイミングで消失するリスクがあります。

## 3. 原因分析
既存のナレッジアイテム (`history_deletion_investigation.md`) の分析通り、これはエージェントシステムのインフラレベルでの不具合（クリーンアップ処理の誤作動、または永続化の失敗）です。
エージェント自身の操作ミスではなく、**保存されるべき場所からファイルが勝手に消えている**状態です。

**「Trust Failure」 (信頼の崩壊)**
エージェントの「記憶」をシステムに委ねることができない状態です。

## 4. 確定した対策（アクションアイテム）

**「エージェントのBrainは揮発性メモリである」と見なし、全ての永続化情報をプロジェクト内に退避させます。**

1.  **調査ログ・作業ログの完全移行**:
    - 本ドキュメントのように、調査や思考の記録は必ず `docs/investigation/` や `docs/agent_logs/` にファイルとして保存します。
    - エージェントのチャットログに依存しません。

2.  **タスク管理の外部化**:
    - Brain内の `task.md` は一時的なチェックリストとしてのみ使用し、長期的なタスクや重要なToDoはプロジェクトルートの `TODO.md` やイシュートラッカーで管理します。

本報告書をもって、第5回の消失事例の記録とします。

## 5. 第6回調査報告 (2026-01-26 00:25)
**担当:** Gemini (Session: `975704a7`)

### 状況確認
ユーザーより「6回目」の発生報告あり。直近のセッション状態を再確認しました。

1.  **直前のセッション (`8f37d7f2`)**
    - 状態: **ファイル存在 (生存)** (`task.md` 等が確認可能)
    - 補足: 現時点ではデータは残っていますが、ユーザー側で「チャットが消える」現象が発生している可能性があります（UI上のリンク切れなど）。

2.  **2つ前のセッション (`27c7f4b3`)**
    - 状態: **空 (完全損失)**
    - 前回の報告通り、ディレクトリは存在しますが中身が空です。

### 推定原因: 0時またぎのクリーンアップバグ
「0時過ぎから続いている」という報告と、日付変更線 (JST 00:00) を跨いでからの連続発生から、**エージェントシステム（またはホストOS）の日次クリーンアップ処理、あるいは日付変更に伴うセッション管理ロジックのバグ**が原因である可能性が極めて高いです。
特に `Brain` ディレクトリ内の古い（と誤判定された）セッションデータを物理削除している挙動が見られます。

### 恒久対策の徹底
システム側のバグ修正は我々の権限外であるため、**「Brainは信頼しない」** 運用を徹底します。
- **全ての記録を `docs/` 配下に残すこと。**
- **Artifact (task.md等) はBrainではなくプロジェクトディレクトリで管理すること（推奨）。**

本件に関する調査は以上とし、以降はプロジェクトディレクトリベースでの作業継続を強く推奨します。
