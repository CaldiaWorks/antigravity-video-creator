# チャット履歴消失問題 調査レポート

## 概要
ユーザーより報告されたチャット履歴消失問題（3回目）について、エージェントの内部記憶領域（Brain）およびファイルシステムを調査した結果をまとめる。

## 調査結果

### 1. 内部記憶領域の状況
`/Users/mtd/.gemini/antigravity/brain/` 以下の会話データを確認した。

| 会話ID (一部) | 時期 | 状態 | 判定 |
| :--- | :--- | :--- | :--- |
| `355943e1...` | **現在** | **空 (Empty)** | ⚠️ データなし（現在進行中だがファイル未生成の可能性あり） |
| `16367a33...` | 前回の会話 | **ファイルあり** | 正常 (task.md等が存在) |
| `12daffb2...` | 前々回の会話 | **空 (Empty)** | ❌ **データ消失** |

### 2. 原因の特定
**物理的なデータ消失**が発生している。
特に前々回の会話 (`12daffb2...`) のディレクトリは存在するものの、中身が空になっている。これにより、履歴リストに表示されない、あるいは開いても内容がないという現象が引き起こされている。
既知の問題（KI: `history_deletion_investigation.md`）においても同様の「ディレクトリは残るが中身が消える」現象が報告されており、システム内部のクリーンアップ処理や、書き込み失敗によるデータロストの可能性が高い。
現在の会話についてもディレクトリが空であり、会話終了後に何も残らないリスクがある。

## 対策と提言

### システム的な対策（ユーザー側）
- エディタ（Cursor/VSCode）の再起動や、拡張機能のアップデートを確認する。
- `.gemini` フォルダの権限を確認する（今回の調査では書き込み自体は成功している）。

### **運用上の回避策（推奨）**
**「チャット履歴は消えるもの」と前提し、重要な会話内容や調査結果は、必ずプロジェクト内のファイルとして保存する。**
エージェントに対しては、「結果をファイル（例: `docs/report.md`）にまとめて」と指示することで、チャット履歴が消失しても成果物を確保できる。

## 本レポートについて
このファイル (`investigation_report.md`) は、上記の回避策の実践として作成された。これが残っている限り、チャットが消えても調査結果は失われない。
